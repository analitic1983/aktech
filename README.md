# Slot Service API

Тестовое задание бронирования слотов.
Сервис предоставляет API-эндпоинты для просмотра доступности слотов,
создания идемпотентных «холдов», их атомарного подтверждения и отмены с
корректным ведением кеша.

## Требования

-   PHP 8.2+
-   Composer
-   MySQL 8+
-   Redis (используется для блокировок кеша)

## Установка

``` bash
cp .env.example .env
composer install
php artisan key:generate
# Настройте параметры базы данных в .env
php artisan migrate
```

## Запуск приложения

``` bash
php artisan serve
```

API по умолчанию будет доступно по адресу:\
`http://127.0.0.1:8000`

## Обзор API

  ----------------------------------------------------------------------------
Метод               Endpoint                      Описание
  ------------------- ----------------------------- --------------------------
GET                 `/api/slots/availability`     Кэшированная доступность
всех слотов (активные
холды уменьшают значение
`remaining`).

POST                `/api/slots/{slot}/hold`      Создать или повторно
использовать холд для
указанного слота
(требуется заголовок
`Idempotency-Key`).

POST                `/api/holds/{hold}/confirm`   Подтвердить холд и
атомарно уменьшить
доступность слота.

DELETE              `/api/holds/{hold}`           Отменить холд и вернуть
слот в пул доступных.
  ----------------------------------------------------------------------------

## Примеры использования

Допустим, сервис запущен локально, и слот с ID `1` существует:

``` bash
# Создать новый холд
curl -i   -H "Accept: application/json"   -H "Idempotency-Key: 11111111-1111-1111-1111-111111111111"   -X POST http://127.0.0.1:8000/api/slots/1/hold

# Повторить тот же запрос (идемпотентный вызов)
curl -i   -H "Accept: application/json"   -H "Idempotency-Key: 11111111-1111-1111-1111-111111111111"   -X POST http://127.0.0.1:8000/api/slots/1/hold

# Подтвердить холд (замените {hold_id} на возвращённый ID)
curl -i   -H "Accept: application/json"   -X POST http://127.0.0.1:8000/api/holds/{hold_id}/confirm

# Отменить холд
curl -i   -H "Accept: application/json"   -X DELETE http://127.0.0.1:8000/api/holds/{hold_id}

# Пример конфликта, когда слот исчерпан
curl -i   -H "Accept: application/json"   -H "Idempotency-Key: 22222222-2222-2222-2222-222222222222"   -X POST http://127.0.0.1:8000/api/slots/1/hold
```

Эндпоинт `GET /api/slots/availability` кэширует результаты на 5--15
секунд и использует Redis-блокировки для предотвращения «штормов» кеша.\
Подтверждение или отмена холда очищает соответствующий кеш.
